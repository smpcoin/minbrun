<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPRewardBurn åˆçº¦ç®¡ç†é¢æ¿</title>
    <!-- Bootstrap æ ·å¼ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        /* é€šç”¨æ ·å¼ */
        body {
            background-color: #f5f7fa;
            padding-bottom: 50px;
        }
        .container {
            max-width: 1200px;
        }
        .header-bar {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        .contract-card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 30px;
        }
        .contract-card h4 {
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-label {
            font-weight: 600;
            color: #34495e;
        }
        .btn-custom {
            background-color: #3498db;
            color: #fff;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .btn-custom:hover {
            background-color: #2980b9;
            color: #fff;
        }
        .btn-custom:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .btn-read {
            background-color: #2ecc71;
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            margin-left: 10px;
            transition: all 0.3s;
        }
        .btn-read:hover {
            background-color: #27ae60;
            color: #fff;
        }
        .btn-unlock {
            font-size: 0.8em;
            color: #999;
            cursor: pointer;
            margin-left: 5px;
        }
        .btn-unlock:hover {
            color: #3498db;
        }
        /* çŠ¶æ€æç¤º */
        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 5px;
            display: none;
        }
        .status.loading {
            display: block;
            background-color: #f8f9fa;
            color: #0d6efd;
        }
        .status.success {
            display: block;
            background-color: #d4edda;
            color: #155724;
        }
        .status.error {
            display: block;
            background-color: #f8d7da;
            color: #721c24;
        }
        /* æŠ˜å é¢æ¿ */
        .collapse-btn {
            background: none;
            border: none;
            color: #3498db;
            font-size: 0.9em;
            cursor: pointer;
        }
        .collapse-content {
            margin-top: 15px;
        }
        /* åœ°å€/æ•°å€¼æ ¡éªŒ */
        .is-invalid {
            border-color: #dc3545 !important;
        }
        .invalid-feedback {
            display: block;
            color: #dc3545;
            font-size: 0.85em;
            margin-top: 5px;
        }
        /* åªè¯»æ ·å¼ */
        .addr-input[readonly], .form-control[readonly] {
            background-color: #f8f9fa;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <!-- å¤´éƒ¨ï¼šé’±åŒ…è¿æ¥ + åˆçº¦åœ°å€é…ç½® -->
        <div class="header-bar">
            <div class="row align-items-center">
                <div class="col-md-4 mb-3 mb-md-0">
                    <h3>LPRewardBurn åˆçº¦ç®¡ç†é¢æ¿</h3>
                </div>
                <div class="col-md-8">
                    <!-- é’±åŒ…è¿æ¥ -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <button id="connectWallet" class="btn-custom w-100">è¿æ¥é’±åŒ…</button>
                            <div id="walletStatus" class="mt-2 text-muted">æœªè¿æ¥é’±åŒ…</div>
                        </div>
                        <div class="col-md-6">
                            <select id="chainSelector" class="form-control">
                                <option value="56">BSC ä¸»ç½‘ (56)</option>
                                <option value="97">BSC æµ‹è¯•ç½‘ (97)</option>
                                <option value="1">ä»¥å¤ªåŠä¸»ç½‘ (1)</option>
                                <option value="5">ä»¥å¤ªåŠæµ‹è¯•ç½‘ Goerli (5)</option>
                            </select>
                        </div>
                    </div>

                    <!-- LPRewardBurn åˆçº¦åœ°å€é…ç½®ï¼ˆé¢„è®¾åœ°å€ï¼‰ -->
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <label class="form-label">LPRewardBurn åœ°å€
                                <span class="btn-unlock" onclick="unlockInput('lpRewardBurnAddr')">ğŸ”“ è§£é”</span>
                            </label>
                            <input type="text" id="lpRewardBurnAddr" class="form-control addr-input" 
                                value="0x3Bf12a0C5215F0e3F306545176933c88D342b6D7" readonly placeholder="0x...">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LPRewardBurn åˆçº¦ç®¡ç† -->
        <div class="contract-card">
            <div class="d-flex justify-content-between align-items-center">
                <h4>LPRewardBurn åˆçº¦é…ç½®</h4>
                <button class="collapse-btn" onclick="toggleCollapse('lpRewardBurnCollapse')">æ”¶èµ· â–²</button>
            </div>
            <div id="lpRewardBurnCollapse" class="collapse-content">
                <!-- setToken -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h6>1. è®¾ç½®å¥–åŠ±ä»£å¸åœ°å€</h6>
                        <div class="row align-items-end">
                            <div class="col-md-7">
                                <!-- é¢„è®¾ MiniBTC ä»£å¸åœ°å€ -->
                                <input type="text" id="lrbToken" class="form-control" value="0x0F3BA1d1571511DE2295866E91ea4a6C152A7999" placeholder="ä»£å¸åœ°å€">
                            </div>
                            <div class="col-md-3">
                                <button onclick="callLPRewardBurnFunction('setToken')" class="btn-custom w-100">æ‰§è¡Œ</button>
                            </div>
                            <div class="col-md-2">
                                <button onclick="readLPRewardBurnConfig('token')" class="btn-read w-100">è¯»å–å½“å‰å€¼</button>
                            </div>
                        </div>
                        <div id="lrbTokenStatus" class="status"></div>
                    </div>
                </div>

                <!-- setRewardSigner -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h6>2. è®¾ç½®å¥–åŠ±ç­¾åè€…åœ°å€</h6>
                        <div class="row align-items-end">
                            <div class="col-md-7">
                                <input type="text" id="lrbRewardSigner" class="form-control" placeholder="ç­¾åè€…åœ°å€">
                            </div>
                            <div class="col-md-3">
                                <button onclick="callLPRewardBurnFunction('setRewardSigner')" class="btn-custom w-100">æ‰§è¡Œ</button>
                            </div>
                            <div class="col-md-2">
                                <button onclick="readLPRewardBurnConfig('rewardSigner')" class="btn-read w-100">è¯»å–å½“å‰å€¼</button>
                            </div>
                        </div>
                        <div id="lrbRewardSignerStatus" class="status"></div>
                    </div>
                </div>

                <!-- setBurnBlackHole -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h6>3. è®¾ç½®é”€æ¯é»‘æ´åœ°å€</h6>
                        <div class="row align-items-end">
                            <div class="col-md-7">
                                <input type="text" id="lrbBurnBlackHole" class="form-control" placeholder="é»‘æ´åœ°å€ï¼ˆé»˜è®¤0x000000000000000000000000000000000000dEaDï¼‰">
                            </div>
                            <div class="col-md-3">
                                <button onclick="callLPRewardBurnFunction('setBurnBlackHole')" class="btn-custom w-100">æ‰§è¡Œ</button>
                            </div>
                            <div class="col-md-2">
                                <button onclick="readLPRewardBurnConfig('burnBlackHole')" class="btn-read w-100">è¯»å–å½“å‰å€¼</button>
                            </div>
                        </div>
                        <div id="lrbBurnBlackHoleStatus" class="status"></div>
                    </div>
                </div>

                <!-- setMaxBurnPerDay -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h6>4. è®¾ç½®æ¯æ—¥æœ€å¤§é”€æ¯é‡</h6>
                        <div class="row align-items-end">
                            <div class="col-md-7">
                                <input type="number" id="lrbMaxBurnPerDay" class="form-control" placeholder="æœ€å¤§é”€æ¯é‡ï¼ˆæœ€å°å•ä½ï¼‰" min="0">
                            </div>
                            <div class="col-md-3">
                                <button onclick="callLPRewardBurnFunction('setMaxBurnPerDay')" class="btn-custom w-100">æ‰§è¡Œ</button>
                            </div>
                            <div class="col-md-2">
                                <button onclick="readLPRewardBurnConfig('maxBurnPerDay')" class="btn-read w-100">è¯»å–å½“å‰å€¼</button>
                            </div>
                        </div>
                        <div id="lrbMaxBurnPerDayStatus" class="status"></div>
                    </div>
                </div>
                
                <!-- è·å–åˆçº¦ MiniBTC ä½™é¢ -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h6>5. è·å–åˆçº¦ MiniBTC ä½™é¢</h6>
                        <div class="row align-items-end">
                            <div class="col-md-7">
                                <div class="input-group">
                                    <span class="input-group-text">LPRewardBurn åˆçº¦æŒæœ‰</span>
                                    <input type="text" id="lrbTokenBalance" class="form-control" placeholder="ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–ä½™é¢" readonly>
                                    <span class="input-group-text">MiniBTC</span>
                                </div>
                            </div>
                            <div class="col-md-5">
                                <button onclick="getLPRewardBurnTokenBalance()" class="btn-read w-100">è¯»å–ä½™é¢</button>
                            </div>
                        </div>
                        <div id="lrbTokenBalanceStatus" class="status"></div>
                    </div>
                </div>

                <!-- BurnMiniBtc -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h6>6. æ‰§è¡Œ MiniBTC é”€æ¯</h6>
                        <div class="row mb-2 align-items-end">
                            <div class="col-md-3">
                                <input type="number" id="lrbBurnAmount" class="form-control" placeholder="é”€æ¯æ•°é‡ï¼ˆæœ€å°å•ä½ï¼‰" min="1" required>
                            </div>
                            <div class="col-md-3">
                                <input type="text" id="lrbBurnDate" class="form-control" placeholder="é”€æ¯æ—¥æœŸï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰" readonly>
                            </div>
                            <div class="col-md-3">
                                <button onclick="callLPRewardBurnFunction('BurnMiniBtc')" class="btn-custom w-100">æ‰§è¡Œé”€æ¯</button>
                            </div>
                            <div class="col-md-3">
                                <button onclick="readLPRewardBurnConfig('lastBurnInfo')" class="btn-read w-100">è¯»å–é”€æ¯ä¿¡æ¯</button>
                            </div>
                        </div>
                        <div id="lrbBurnMiniBtcStatus" class="status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ ¸å¿ƒäº¤äº’è„šæœ¬ -->
    <script>
        // å…¨å±€å˜é‡
        let provider, signer, walletAddress;

        // MiniBTC åˆçº¦åœ°å€ (ERC-20)
        const miniBTCTokenAddress = "0x0F3BA1d1571511DE2295866E91ea4a6C152A7999";
        
        // æ ‡å‡† ERC-20 ABI (ç”¨äºæŸ¥è¯¢ä½™é¢å’Œç¬¦å·)
        const erc20ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function decimals() view returns (uint8)",
            "function symbol() view returns (string)"
        ];

        // LPRewardBurn ABI
        const lpRewardBurnABI = [
            "function token() view returns (address)",
            "function rewardSigner() view returns (address)",
            "function burnBlackHole() view returns (address)",
            "function MAX_BURN_PER_DAY() view returns (uint256)",
            "function lastBurnTime() view returns (uint256)",
            "function setToken(address _token) external",
            "function setRewardSigner(address _signer) external",
            "function setBurnBlackHole(address _burnBlackHole) external",
            "function setMaxBurnPerDay(uint256 _max) external",
            "function BurnMiniBtc(uint256 burnAmount, string calldata burnDate) external"
        ];

        // ========== é’±åŒ…è¿æ¥é€»è¾‘ ==========
        window.addEventListener('DOMContentLoaded', async () => {
            updateCurrentDate();

            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        initWallet(accounts[0]);
                    }
                } catch (err) {
                    console.log('æ£€æŸ¥é’±åŒ…çŠ¶æ€å¤±è´¥:', err);
                }

                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length > 0) {
                        initWallet(accounts[0]);
                    } else {
                        resetWalletStatus();
                    }
                });

                window.ethereum.on('chainChanged', (chainId) => {
                    window.location.reload();
                });
            }
        });

        async function initWallet(addr) {
            walletAddress = addr;
            provider = new ethers.providers.Web3Provider(window.ethereum, 'any');
            await provider.send('eth_requestAccounts', []);
            signer = provider.getSigner();
            
            document.getElementById('walletStatus').textContent = `å·²è¿æ¥: ${walletAddress.substring(0, 6)}...${walletAddress.substring(38)}`;
            document.getElementById('walletStatus').style.color = '#198754';
            document.getElementById('connectWallet').textContent = 'åˆ‡æ¢é’±åŒ…';

            // è¿æ¥é’±åŒ…åï¼Œè‡ªåŠ¨è¯»å–ä¸€æ¬¡ä½™é¢
            getLPRewardBurnTokenBalance();
        }

        function resetWalletStatus() {
            walletAddress = null;
            provider = null;
            signer = null;
            document.getElementById('walletStatus').textContent = 'æœªè¿æ¥é’±åŒ…';
            document.getElementById('walletStatus').style.color = '#6c757d';
            document.getElementById('connectWallet').textContent = 'è¿æ¥é’±åŒ…';
            document.getElementById('lrbTokenBalance').value = '';
        }

        document.getElementById('connectWallet').addEventListener('click', async () => {
            if (!window.ethereum) {
                alert('è¯·å®‰è£…MetaMaské’±åŒ…ï¼ˆæˆ–å…¶ä»–EVMå…¼å®¹é’±åŒ…ï¼‰ï¼');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts'
                });

                if (accounts.length === 0) {
                    throw new Error('æœªæˆæƒä»»ä½•è´¦æˆ·');
                }

                initWallet(accounts[0]);
            } catch (error) {
                document.getElementById('walletStatus').textContent = `è¿æ¥å¤±è´¥: ${error.message}`;
                document.getElementById('walletStatus').style.color = '#dc3545';
                console.error('é’±åŒ…è¿æ¥é”™è¯¯:', error);
            }
        });

        // åˆ‡æ¢é“¾é€»è¾‘
        document.getElementById('chainSelector').addEventListener('change', async (e) => {
            if (!window.ethereum) {
                alert('è¯·å®‰è£…MetaMaské’±åŒ…ï¼');
                return;
            }

            const chainId = e.target.value;
            const hexChainId = ethers.utils.hexValue(parseInt(chainId));

            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: hexChainId }],
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    alert(`å½“å‰é’±åŒ…æœªæ·»åŠ è¯¥é“¾ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ é“¾ID ${chainId} åé‡è¯•ï¼`);
                } else {
                    alert(`åˆ‡æ¢é“¾å¤±è´¥: ${switchError.message}`);
                }
            }
        });

        // è§£é”/é”å®šè¾“å…¥æ¡†
        function unlockInput(id) {
            const input = document.getElementById(id);
            if (input.readOnly) {
                input.readOnly = false;
                input.style.backgroundColor = '#fff';
                input.style.cursor = 'text';
                const unlockBtn = input.parentElement.querySelector('.btn-unlock');
                unlockBtn.textContent = 'ğŸ”’ é”å®š';
                unlockBtn.onclick = () => lockInput(id);
            }
        }

        function lockInput(id) {
            const input = document.getElementById(id);
            input.readOnly = true;
            input.style.backgroundColor = '#f8f9fa';
            input.style.cursor = 'not-allowed';
            const unlockBtn = input.parentElement.querySelector('.btn-unlock');
            unlockBtn.textContent = 'ğŸ”“ è§£é”';
            unlockBtn.onclick = () => unlockInput(id);
        }

        // æŠ˜å /å±•å¼€é¢æ¿
        function toggleCollapse(id) {
            const content = document.getElementById(id);
            const btn = content.parentElement.querySelector('.collapse-btn');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                btn.textContent = 'æ”¶èµ· â–²';
            } else {
                content.style.display = 'none';
                btn.textContent = 'å±•å¼€ â–¼';
            }
        }

        // ========== æ–°å¢åŠŸèƒ½ï¼šè·å– LPRewardBurn åˆçº¦çš„ MiniBTC ä½™é¢ ==========
        async function getLPRewardBurnTokenBalance() {
            if (!provider) {
                return alert('è¯·å…ˆè¿æ¥é’±åŒ…ï¼');
            }
            
            const lpRewardBurnAddr = document.getElementById('lpRewardBurnAddr').value;
            if (!ethers.utils.isAddress(lpRewardBurnAddr)) {
                return alert('LPRewardBurn åˆçº¦åœ°å€æ— æ•ˆï¼');
            }

            const statusEl = document.getElementById('lrbTokenBalanceStatus');
            const balanceEl = document.getElementById('lrbTokenBalance');

            try {
                statusEl.className = 'status loading';
                statusEl.textContent = 'æ­£åœ¨æŸ¥è¯¢ä½™é¢...';

                const tokenContract = new ethers.Contract(miniBTCTokenAddress, erc20ABI, provider);
                
                // è·å–ä½™é¢ï¼ˆæœ€å°å•ä½ï¼‰
                const balanceBN = await tokenContract.balanceOf(lpRewardBurnAddr);
                
                // è·å–ä»£å¸ç²¾åº¦
                const decimals = await tokenContract.decimals();
                
                // æ ¼å¼åŒ–ä½™é¢ä¸ºå¯è¯»æ ¼å¼
                const formattedBalance = ethers.utils.formatUnits(balanceBN, decimals);

                balanceEl.value = formattedBalance;
                
                statusEl.className = 'status success';
                statusEl.textContent = `æŸ¥è¯¢æˆåŠŸï¼`;

            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `æŸ¥è¯¢å¤±è´¥: ${error.message}`;
                console.error('è·å–ä½™é¢é”™è¯¯:', error);
            }
        }


        // ========== è¯»å–é…ç½®å‡½æ•° ==========
        // è¯»å–LPRewardBurné…ç½®
        async function readLPRewardBurnConfig(configKey) {
            if (!provider) return alert('è¯·å…ˆè¿æ¥é’±åŒ…ï¼');
            const contractAddr = document.getElementById('lpRewardBurnAddr').value;
            if (!ethers.utils.isAddress(contractAddr)) return alert('LPRewardBurnåœ°å€æ— æ•ˆï¼');
            
            const contract = new ethers.Contract(contractAddr, lpRewardBurnABI, provider);
            const statusEl = document.getElementById(`lrb${configKey.charAt(0).toUpperCase() + configKey.slice(1)}Status`) || document.getElementById('lrbBurnMiniBtcStatus');
            
            try {
                statusEl.className = 'status loading';
                statusEl.textContent = 'æ­£åœ¨è¯»å–é…ç½®...';
                
                let value;
                switch(configKey) {
                    case 'token': value = await contract.token(); break;
                    case 'rewardSigner': value = await contract.rewardSigner(); break;
                    case 'burnBlackHole': value = await contract.burnBlackHole(); break;
                    case 'maxBurnPerDay': value = await contract.MAX_BURN_PER_DAY(); break;
                    case 'lastBurnInfo':
                        const lastTime = await contract.lastBurnTime();
                        const maxBurn = await contract.MAX_BURN_PER_DAY();
                        const remainingTime = lastTime + 86400 - Math.floor(Date.now()/1000);
                        let timeText = remainingTime > 0 ? `${Math.floor(remainingTime/3600)}å°æ—¶${Math.floor((remainingTime%3600)/60)}åˆ†é’Ÿ` : 'å¯ç«‹å³é”€æ¯';
                        statusEl.className = 'status success';
                        statusEl.textContent = `æœ€åé”€æ¯æ—¶é—´: ${new Date(lastTime * 1000).toLocaleString()}, æ¯æ—¥æœ€å¤§é”€æ¯é‡: ${maxBurn}, ä¸‹æ¬¡é”€æ¯æ—¶é—´: ${timeText}`;
                        return;
                    default: return alert('æ— æ•ˆçš„é…ç½®é¡¹ï¼');
                }
                
                document.getElementById(`lrb${configKey.charAt(0).toUpperCase() + configKey.slice(1)}`).value = value;
                
                statusEl.className = 'status success';
                statusEl.textContent = `è¯»å–æˆåŠŸ: ${value}`;
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `è¯»å–å¤±è´¥: ${error.message}`;
            }
        }

        // ========== æ‰§è¡Œè®¾ç½®å‡½æ•° ==========
        // æ‰§è¡ŒLPRewardBurnå‡½æ•°
        async function callLPRewardBurnFunction(funcName) {
            if (!provider || !signer) return alert('è¯·å…ˆè¿æ¥é’±åŒ…ï¼');
            const contractAddr = document.getElementById('lpRewardBurnAddr').value;
            if (!ethers.utils.isAddress(contractAddr)) return alert('LPRewardBurnåœ°å€æ— æ•ˆï¼');
            
            const contract = new ethers.Contract(contractAddr, lpRewardBurnABI, signer);
            const statusEl = document.getElementById(`lrb${funcName.charAt(0).toUpperCase() + funcName.slice(1)}Status`) || document.getElementById('lrbBurnMiniBtcStatus');
            
            try {
                statusEl.className = 'status loading';
                statusEl.textContent = 'äº¤æ˜“å¤„ç†ä¸­ï¼Œè¯·ç­‰å¾…...';
                
                let tx;
                switch(funcName) {
                    case 'setToken':
                        const tokenAddr = document.getElementById('lrbToken').value;
                        if (!ethers.utils.isAddress(tokenAddr)) throw new Error('å¥–åŠ±ä»£å¸åœ°å€æ— æ•ˆ');
                        tx = await contract.setToken(tokenAddr);
                        break;
                    case 'setRewardSigner':
                        const signerAddr = document.getElementById('lrbRewardSigner').value;
                        if (!ethers.utils.isAddress(signerAddr)) throw new Error('å¥–åŠ±ç­¾åè€…åœ°å€æ— æ•ˆ');
                        tx = await contract.setRewardSigner(signerAddr);
                        break;
                    case 'setBurnBlackHole':
                        const blackHoleAddr = document.getElementById('lrbBurnBlackHole').value || '0x000000000000000000000000000000000000dEaD';
                        if (!ethers.utils.isAddress(blackHoleAddr)) throw new Error('é»‘æ´åœ°å€æ— æ•ˆ');
                        tx = await contract.setBurnBlackHole(blackHoleAddr);
                        break;
                    case 'setMaxBurnPerDay':
                        const maxBurn = document.getElementById('lrbMaxBurnPerDay').value;
                        if (maxBurn < 0) throw new Error('æ¯æ—¥æœ€å¤§é”€æ¯é‡ä¸èƒ½ä¸ºè´Ÿæ•°');
                        tx = await contract.setMaxBurnPerDay(ethers.BigNumber.from(maxBurn));
                        break;
                    case 'BurnMiniBtc':
                        const burnAmount = document.getElementById('lrbBurnAmount').value;
                        const burnDate = getCurrentDateString();

                        if (burnAmount < 1) throw new Error('é”€æ¯æ•°é‡å¿…é¡»å¤§äº0');
                        if (!/^\d{4}-\d{2}-\d{2}$/.test(burnDate)) throw new Error('æ—¥æœŸæ ¼å¼é”™è¯¯ï¼ˆåº”ä¸ºYYYY-MM-DDï¼‰');
                        
                        tx = await contract.BurnMiniBtc(ethers.BigNumber.from(burnAmount), burnDate);
                        break;
                    default:
                        throw new Error(`ä¸æ”¯æŒçš„å‡½æ•°: ${funcName}`);
                }

                await tx.wait();
                statusEl.className = 'status success';
                statusEl.textContent = 'æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œ: ' + tx.hash.substring(0, 10) + '...';
                
                // é‡æ–°è¯»å–é…ç½®
                const configKeyMap = {
                    'setToken': 'token',
                    'setRewardSigner': 'rewardSigner',
                    'setBurnBlackHole': 'burnBlackHole',
                    'setMaxBurnPerDay': 'maxBurnPerDay',
                    'BurnMiniBtc': 'lastBurnInfo'
                };
                if (configKeyMap[funcName]) {
                    setTimeout(() => readLPRewardBurnConfig(configKeyMap[funcName]), 1000);
                }
                // å¦‚æœæ˜¯é”€æ¯æ“ä½œï¼Œä¹Ÿé‡æ–°è·å–ä½™é¢
                if (funcName === 'BurnMiniBtc') {
                     setTimeout(() => getLPRewardBurnTokenBalance(), 1500);
                }

            } catch (error) {
                let errorMsg = error.message;
                if (errorMsg.includes('only owner')) {
                    errorMsg = 'æ‰§è¡Œå¤±è´¥ï¼šä»…åˆçº¦æ‹¥æœ‰è€…å¯è°ƒç”¨è¯¥å‡½æ•°';
                } else if (errorMsg.includes('invalid address')) {
                    errorMsg = 'æ‰§è¡Œå¤±è´¥ï¼šæ— æ•ˆçš„åœ°å€æ ¼å¼';
                } else if (errorMsg.length > 100) {
                    errorMsg = errorMsg.substring(0, 100) + '...';
                }
                
                statusEl.className = 'status error';
                statusEl.textContent = `æ‰§è¡Œå¤±è´¥: ${errorMsg}`;
                console.error('LPRewardBurnæ‰§è¡Œé”™è¯¯:', error);
            }
        }

        // é¡µé¢åˆå§‹åŒ–ï¼šé»˜è®¤å±•å¼€æ‰€æœ‰é¢æ¿
        window.onload = function() {
            document.querySelectorAll('.collapse-content').forEach(el => {
                el.style.display = 'block';
            });
            document.querySelectorAll('.collapse-btn').forEach(btn => {
                btn.textContent = 'æ”¶èµ· â–²';
            });
        };

        function getCurrentDateString() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function updateCurrentDate() {
            const dateInput = document.getElementById('lrbBurnDate');
            if (dateInput) {
                dateInput.value = getCurrentDateString();
            }
        }
    </script>
</body>
</html>
